document.body.innerHTML+="<canvas id='canv' oncontextmenu='return false;'></canvas>";var link=document.createElement("link");link.href="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",link.rel="icon",link.type="image/x-icon",document.getElementsByTagName("head")[0].appendChild(link),document.body.style.setProperty("margin","0px"),document.documentElement.style.setProperty("margin","0px"),document.documentElement.style.setProperty("overflow","hidden"),document.getElementById("canv").addEventListener("mousemove",mouseMove),document.getElementById("canv").addEventListener("mousedown",mouseDown),document.getElementById("canv").addEventListener("mouseup",mouseUp),document.getElementById("canv").addEventListener("mousewheel",mouseWheel);let o={width:0,height:0,cameraCenterX:0,cameraCenterY:0,isMouseDown:!(document.title="PS"),lastMouseX:0,lastMouseY:0,maxZoom:100,minZoom:.1,cameraZoom:1,fillColor:"lightgray",millisecondsBetweenFrames:33};o.secondsBetweenFrames=1/o.millisecondsBetweenFrames,o.time=o.secondsBetweenFrames;let c,canvas;function resizeCanvas(){o.width=window.innerWidth,o.height=window.innerHeight,canvas.width=o.width,canvas.height=o.height}function cs(){return o.scenes[o.currentScene]}function initialBoot(){i.attach(document),resizeCanvas(),"function"==typeof firstUpdate&&firstUpdate(c,o),o.scenes&&(o.currentScene=0,o.sceneChange=!1,o.changeScene=function(e){o.newSceneIndex=e,o.sceneChange=!0}),"function"==typeof cs().firstUpdate&&cs().firstUpdate(c,o),void 0!==o.tickOnce&&o.tickOnce?console.log("Ticking only once."):setInterval(tick,o.millisecondsBetweenFrames)}function tick(){(new Date).getTime();update(),drawCanvas()}function update(){i.update(),o?.sceneChange&&(o.sceneChange=!1,o.currentScene=o.newSceneIndex,"function"==typeof cs().firstUpdate)&&cs().firstUpdate(c,o),"function"==typeof customUpdate&&customUpdate(c,o),"function"==typeof cs().customUpdate&&cs().customUpdate(c,o),drawCanvas()}function drawCanvas(){if(resizeCanvas(),c.fillStyle=o.fillColor,c.fillRect(0,0,canvas.width,canvas.height),o.drawGrid){c.fo("10px Arial").fi("white"),[e,t]=o.toWorldSpace(0,0),[n,s]=o.toWorldSpace(c.canvas.width,c.canvas.height);var e,t,n,s,i,a,r,u,m,l,d,h,f,y,p=Math.min(n-e,s-t),w=Math.log10(p)/Math.log10(10),w=Math.floor(w-.5);w=Math.pow(10,w),i=parseInt((e-w)/w)*w,r=n,a=parseInt((t-w)/w)*w,u=s;for(let e=i;e<=r;e+=w)[m,l]=o.toScreenSpace(e,a),[m,d]=o.toScreenSpace(e,u),c.strokeStyle="gray",0==e&&(c.strokeStyle="green"),c.beginPath(),c.moveTo(m,l),c.lineTo(m,d),c.stroke(),c.fillStyle="white",c.fillText(e.toFixed(2),m+20,20);for(let e=a;e<=u;e+=w)[h,f]=o.toScreenSpace(i,e),[y,f]=o.toScreenSpace(r,e),c.strokeStyle="gray",0==e&&(c.strokeStyle="red"),c.beginPath(),c.moveTo(h,f),c.lineTo(y,f),c.stroke(),c.fillStyle="white",c.fillText((-e).toFixed(2),20,f+20)}c.save(),c.translate(o.width/2-o.cameraCenterX,o.height/2-o.cameraCenterY),c.scale(o.cameraZoom,-o.cameraZoom),"function"==typeof customDraw&&customDraw(c,o),"function"==typeof cs().customDraw&&cs().customDraw(c,o),c.restore(),"function"==typeof cs().customUI&&cs().customUI(c,o)}function mouseMove(e){var t,n;isCameraDisabled()||(t=e.clientX,n=e.clientY,o.isMouseDown&&(t=t-o.lastMouseX,n=n-o.lastMouseY,o.cameraCenterX-=t,o.cameraCenterY-=n),o.lastMouseX=e.clientX,o.lastMouseY=e.clientY)}function mouseDown(e){isCameraDisabled()||(e.clientX,e.clientY,o.lastMouseX=e.clientX,o.lastMouseY=e.clientY,o.isMouseDown=!0)}function mouseUp(e){isCameraDisabled()||(e.clientX,e.clientY,o.lastMouseX=e.clientX,o.lastMouseY=e.clientY,o.isMouseDown=!1)}function mouseWheel(e){var t,n,s;isCameraDisabled()||(t=e.clientX-(o.width/2-o.cameraCenterX),n=e.clientY-(o.height/2-o.cameraCenterY),t/=o.cameraZoom,n/=o.cameraZoom,0<e.wheelDelta?o.cameraZoom*=1.01:e.wheelDelta<0&&(o.cameraZoom/=1.01),o.cameraZoom>o.maxZoom&&(o.cameraZoom=o.maxZoom),o.cameraZoom<o.minZoom&&(o.cameraZoom=o.minZoom),s=e.clientX-(o.width/2-o.cameraCenterX),e=e.clientY-(o.height/2-o.cameraCenterY),s/=o.cameraZoom,e/=o.cameraZoom,o.cameraCenterX-=s-t,o.cameraCenterY-=e-n)}function isCameraDisabled(){return void 0!==o.disableCameraMovement&&o.disableCameraMovement}canvas=document.getElementById("canv"),c=canvas.getContext("2d"),o.toWorldSpace=function(e,t){e-=o.width/2-o.cameraCenterX,t-=o.height/2-o.cameraCenterY;return[e/=o.cameraZoom,t/=o.cameraZoom]},o.toScreenSpace=function(e,t){e*=o.cameraZoom,t*=o.cameraZoom;return[e+=o.width/2-o.cameraCenterX,t+=o.height/2-o.cameraCenterY]},o.lookAt=function(e,t){return o.cameraCenterX=e*o.cameraZoom,o.cameraCenterY=t*-o.cameraZoom,this},o.zoom=function(e){return e=c.canvas.height/e,o.cameraZoom=e,this},c.b=function(){return c.beginPath(),this},c.m=function(e,t){return c.moveTo(e,t),this},c.l=function(e,t){return c.lineTo(e,t),this},c.s=function(){return c.stroke(),this},c.f=function(){return c.fill(),this},c.st=function(e){return c.strokeStyle=e,this},c.fi=function(e){return c.fillStyle=e,this},c.fo=function(e){return c.font=e,this},c.text=function(e,t,o){return c.fillText(e,t,o),this},c.tc=function(e,t,o){var n=c.measureText(e);return this.text(e,t-n.width/2,o-n.fontBoundingBoxAscent/2),this},c.circle=function(e,t,o){return c.arc(e,t,o,0,2*Math.PI),this};class i{static keys=[];static keysDown=[];static keysUp=[];static frameKeysDown=[];static frameKeysUp=[];static mouseButtons=[];static mouseButtonsDown=[];static mouseButtonsUp=[];static frameMouseButtonsDown=[];static frameMouseButtonUp=[];static mousePositionX;static mousePositionY;static frameMousePositionX;static frameMousePositionY;static lastFrameMousePositionX;static lastFrameMousePositionY;static scrollWheel=0;static frameScrollWheel=0;static update(){this.frameKeysDown=this.keysDown,this.frameKeysUp=this.keysUp,this.keysDown=[],this.keysUp=[],this.frameMouseButtonsDown=this.mouseButtonsDown,this.frameMouseButtonsUp=this.mouseButtonsUp,this.mouseButtonsDown=[],this.mouseButtonsUp=[],this.lastFrameMousePositionX=this.frameMousePositionX,this.lastFrameMousePositionY=this.frameMousePositionY,this.frameMousePositionX=this.mousePositionX,this.frameMousePositionY=this.mousePositionY,this.frameScrollWheel=this.scrollWheel,this.scrollWheel=0}static getKey(e){return this.keys[e]}static getKeyDown(e){return this.frameKeysDown[e]}static down(e,t){i.getKeyDown(e)&&t()}static getKeyUp(e){return this.frameKeysUp[e]}static getMouseButton(e){return this.mouseButtons[e]}static getMouseButtonDown(e){return this.frameMouseButtonsDown[e]}static getMouseButtonUp(e){return this.frameMouseButtonsUp[e]}static getScrollWheel(){return this.frameScrollWheel}static getMousePosition(){return{x:this.frameMousePositionX,y:this.frameMousePositionY}}static getMousePositionDelta(){return{dx:this.frameMousePositionX-this.lastFrameMousePositionX,dy:this.frameMousePositionY-this.lastFrameMousePositionY}}static attach(e){e.body.addEventListener("keydown",function(e){1!=i.keys[e.key]&&(i.keysDown[e.key]=!0);i.keys[e.key]=!0}),e.body.addEventListener("keyup",function(e){0!=i.keys[e.key]&&(i.keysUp[e.key]=!0);i.keys[e.key]=!1}),e.body.addEventListener("keypress",function(e){}),e.body.addEventListener("mousedown",function(e){1!=i.mouseButtons[""+e.button]&&(i.mouseButtonsDown[""+e.button]=!0);i.mouseButtons[""+e.button]=!0}),e.body.addEventListener("mouseup",function(e){0!=i.mouseButtons[e.button]&&(i.mouseButtonsUp[e.button]=!0);i.mouseButtons[e.button]=!1}),e.body.addEventListener("mousemove",function(e){i.mousePositionX=e.clientX,i.mousePositionY=e.clientY}),e.body.addEventListener("wheel",function(e){0!=e.deltaY&&(i.mouseScrollDelta=e.deltaY)}),e.body.addEventListener("contextmenu",function(e){null!=e.preventDefault&&e.preventDefault();null!=e.stopPropagation&&e.stopPropagation();return!1})}}initialBoot();
